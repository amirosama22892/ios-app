workflows:
  ios_build:
    name: Build iOS BarberSalon App (TAR.GZ Source)
    instance_type: mac_mini_m2
    max_build_duration: 60

    environment:
      xcode: latest
      cocoapods: default

    scripts:
      - name: Extract iOS source
        script: |
          echo "üì¶ Extracting iOS source..."
          tar -xzf ios_source.tar.gz -C .
          echo "‚úÖ Extracted files:"
          ls -R .

      - name: Locate project folder
        script: |
          echo "üîç Locating BarberSalon.xcworkspace..."
          FOLDER=$(find . -type f -name "BarberSalon.xcworkspace" | head -1 | xargs dirname)
          if [ -z "$FOLDER" ]; then
            echo "‚ùå BarberSalon.xcworkspace not found after extraction!"
            exit 1
          fi
          echo "‚úÖ Found project folder: $FOLDER"
          echo "$FOLDER" > folder_path.txt

      - name: Install dependencies
        script: |
          FOLDER=$(cat folder_path.txt)
          cd "$FOLDER"
          echo "üì¶ Installing CocoaPods..."
          if [ -f "Podfile" ]; then
            pod install --repo-update
          else
            echo "‚ö†Ô∏è No Podfile found ‚Äî skipping pod install."
          fi

      - name: Build iOS app
        script: |
          FOLDER=$(cat folder_path.txt)
          cd "$FOLDER"
